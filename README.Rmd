---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# chk

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![Travis build status](https://travis-ci.com/poissonconsulting/chk.svg?branch=master)](https://travis-ci.com/poissonconsulting/chk)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/poissonconsulting/chk?branch=master&svg=true)](https://ci.appveyor.com/project/poissonconsulting/chk)
[![Codecov test coverage](https://codecov.io/gh/poissonconsulting/chk/branch/master/graph/badge.svg)](https://codecov.io/gh/poissonconsulting/chk?branch=master)
[![License: CC0](https://img.shields.io/badge/License-CC0-blue.svg)](https://creativecommons.org/publicdomain/zero/1.0/)
<!-- badges: end -->

`chk` is an R package for developers to check user-supplied inputs to their functions.

It is designed to be simple, customisable and fast.

## Installation

To install the latest release version from [CRAN](https://cran.r-project.org)
```r
install.packages("chk")
```

To install the latest development version from [GitHub](https://github.com/poissonconsulting/chk)
```r
# install.packages("remotes")
remotes::install_github("poissonconsulting/chk")
```

## Demonstration

### Simple

`chk` provides simple commonly used checks which can be combined together
for more complex checking.

```{r, error = TRUE}
library(chk)

y <- "a"

chk_flag(y)
chk_string(y)

data <- data.frame(x = 1)
chk_is(data, "data.frame")
chk_length(nrow(data), 1)
chk_length(nrow(data), 2:3)

z <- "b"
chkor(chk_flag(z), chk_number(z))
chkor(chk_flag(z), chk_string(z))
```

By default, each check returns TRUE if successful or throws an informative error.

### Customisable

The functions are designed to be customisable.

If `err = FALSE` a check returns FALSE (instead of throwing an error) on check failure.

```{r}
chk_flag(1, err = FALSE)
```

This allows developers to provide their own error messages.

```{r, error = TRUE}
if(!chk_flag(1, err = FALSE)) stop("x MUST be a flag (try as.logical())")
```

`chk` is released under the [CC0](https://creativecommons.org/publicdomain/zero/1.0/) licence so developers 
can copy and paste individual functions (and tests) into their packages 
without any need for creditation which is useful if they want to minimise their dependencies.

### Fast

The functions are designed to be fast. 

As they are not expected to be directly exposed to users the `chk` functions 
don't check any of their inputs (other than the first argument of course!).

If a function is being called internally the checks can be turned off as follows
```{r, error = TRUE}
fun <- function(x, ...) {
  if(is_chk_on()) {
    chk_flag(x)
    chk_unused(...)
  }
  x
}

wrapper_on_fun <- function(x) {
  if(is_chk_on()) {
    chk_off()
    on.exit(chk_on())
  }
  fun(x)
}

fun(FALSE) # calls fun with checking as being called by user
wrapper_on_fun(FALSE) # calls fun without checking as being used internally
```
It is only worth doing this if the checks are substantially slower
than the time required to test and set checking on and off (see [Benchmarking chk]( https://poissonconsulting.github.io/chk/articles/benchmarking-chk.html))

## Inspiration

- [datacheckr](https://github.com/poissonconsulting/datacheckr/)
- [checkr](https://github.com/poissonconsulting/checkr/)

## Contribution

Please report any [issues](https://github.com/poissonconsulting/chk/issues).

[Pull requests](https://github.com/poissonconsulting/chk/pulls) are always welcome.

Please note that this project is released with a [Contributor Code of Conduct](https://github.com/poissonconsulting/chk/blob/master/CODE_OF_CONDUCT.md).
By contributing, you agree to abide by its terms
