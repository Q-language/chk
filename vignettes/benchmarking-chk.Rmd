---
title: "Benchmarking chk"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Benchmarking chk}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
  
```{r, include = FALSE}
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
```

```{r setup}
library(chk)
library(microbenchmark)
```

```{r}

fun_checking <- function(x, ...) {
  chk_flag(x)
  chk_unused(...)  
  x
}

fun_conditional_checking <- function(x, ...) {
  if(is_chk_on()) {
    chk_flag(x)
    chk_unused(...)
  }
  x
}

wrapper_on_fun_checking <- function(x) {
  fun_checking(x)
}

wrapper_on_fun_conditional_checking <- function(x) {
  if(is_chk_on()) {
    chk_off()
    on.exit(chk_on())
  }
  fun_conditional_checking(x)
}

chk_on()
microbenchmark(
  wrapper_on_fun_checking(TRUE),
  wrapper_on_fun_conditional_checking(TRUE)
)

chk_off()
microbenchmark(
  wrapper_on_fun_checking(TRUE),
  wrapper_on_fun_conditional_checking(TRUE)
)
```
