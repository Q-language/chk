---
title: "Microbenchmarking chk"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Microbenchmarking chk}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(chk)
library(microbenchmark)
```

```{r}

fun <- function(x) chk_length(x, c(1,2,3))

fun_chk <- function(x, chk = TRUE) {
  if(isTRUE(chk)) fun(x)
  x
}

fun_option <- function(x) {
  if(getOption("chk.chk", TRUE)) fun(x)
  x
}

fun_chk2 <- function(x) fun_chk(x, chk = FALSE)

fun_option2 <- function(x) {
  chk.chk <- options(chk.chk = FALSE)
  on.exit(options(chk.chk))
  fun_option(x)
}

microbenchmark(
  fun_chk2(numeric(0)),
  fun_chk2(1),
  fun_option2(numeric(0)),
  fun_option2(1)
)
```
